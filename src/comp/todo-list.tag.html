<todo-list>
	<div class="row">
		<h2>Issue Tracker</h2>
	</div>
	<div class="row">
		<h2>Issues</h2>
		<div class="col-md-12">
			<todo-form todos="{ this.todos }"></todo-form>
			<ul>
				<todo each="{ allTodos() }"></todo>
			</ul>
			<div id="issue-detail"></div>
		</div>
	</div>

<script>
	var tag = this;
	this.bus = opts.bus;

	this.todos = new TodoCollection(bus, opts.projectid);
	this.detail = null;

	var todoRouter = riot.route.create();

	todoRouter('todo', function() {
		console.log("home");
		if (tag.detail) {
			tag.detail[0].unmount(true);
		}
	});

	todoRouter('todo/*/*', function(id, action) {
		var todo = tag.todos.get(id);
		console.log(todo);
		tag.detail = riot.mount("#issue-detail", 'todo-detail', {
			todo : todo,
			bus : tag.bus
		});
		console.log(detail);
		console.log(id, action);
	});

	this.allTodos = function() {
		return this.todos.all();
	};

	this.bus.on("collectionUpdated", function() {
		tag.update();
	});

	this.on("mount", function() {
		this.todos.fetch();
	});
</script>
</todo-list>