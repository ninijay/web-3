<project-list>
    <div class="container">
        <h2>Projects</h2>
        <project-form projects="{ this.projects }"></project-form>
        <ul>
            <project each="{ allProjects() }"></project>
        </ul>
        <div id="todolist"></div>
    </div>

    <script>
        var tag = this;
        this.bus = opts.bus;

        this.projects = new ProjectCollection(bus);
        this.todos = null;

        var projectRouter = riot.route.create();

        projectRouter('project', function () {
            console.log("home");
            if (tag.todos) {
                tag.todos[0].unmount(true);
            }
        });

        projectRouter('project/*/*', function (id, action) {
            var project = tag.projects.get(id);
            console.log(action);
            console.log(project);
            tag.todos= riot.mount("#todolist", 'todo-list', {
                projectid: id, bus: tag.bus
            });
            console.log(tag.todos);
            console.log(id, action);
        });

        this.allProjects = function () {
            return this.projects.all();
        };

        this.bus.on("collectionUpdated", function () {
            tag.update();
        });

        this.on("mount", function () {
            this.projects.fetch();
        });
    </script>
</project-list>